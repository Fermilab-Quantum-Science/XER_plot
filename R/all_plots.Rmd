---
title: "R Notebook"
output: html_notebook
---


```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(readxl)
library(writexl)
library(stringr)
library(rlang)
library(lubridate)

library(MAGIS100PM)
```


```{r}
#all <- get.all.schedule("BLBCR")
all <- get.all.schedule("WS2309")
charges <- get.all.kronos()
people <- get.p6.people(charges, all)
tasks.people <- combine.tasks.people(people, all)
```

```{r}
labor <- bin.labor(tasks.people)
costs <- bin.expenses(all$all.data)
costs.week <- costs$target.by.week%>% filter(FY>=2023&FY<2028)%>%group_by(FY)%>%mutate(csum=cumsum(hsum))
```


```{r}
fte<- FTE.plots(labor$by.day.all%>%filter(code!='other'))
activities<- activities.plot(all$all.data, start.date=as.Date('2023-08-01'),end.date=as.Date('2023-12-01'))
milestones<- milestones.plot(all$all.data)
resources<- resources.plot(labor$by.week, device="png")
proc<- procurements.plot(all, en=Sys.Date()+weeks(8*4))
reviews<- reviews.plot(all$all.data)
```

```{r}
ggsave(resources, filename=paste(base.path,"/hours.png",sep=''), width=24, units='in', device='png')
ggsave(milestones, filename=paste(base.path,'/milestones.png',sep=''), width=11, units='in', device="png")
ggsave(activities, filename=paste(base.path,"/active.pdf",sep=''),width=11, units="in", device="pdf")
ggsave(reviews, filename=paste(base.path,"/reviews.pdf",sep=''),units="in", width=11, device="pdf")
ggsave(proc$plot, filename=paste(base.path,"/procurements.pdf",sep=''),units="in", width=16, device="pdf")
ggsave(fte[[1]], filename=paste(base.path,"/fte_role.png",sep=''),units="in", device="png")
ggsave(fte[[2]], filename=paste(base.path,"/fte_div.png",sep=''),units="in", device="png")

```


```{r}
print(proc$plot)
print(milestones)
#print(fte[[1]])
#print(fte[[2]])
#print(fte[[3]])
#print(fte[[4]])
print(resources)
print(activities)
print(reviews)
```

#```{r}
#activities<- activities.plot(all$all.data, interval(as.Date('2024-09-01'),as.Date('2025-11-01')),tcost=1)
#```

